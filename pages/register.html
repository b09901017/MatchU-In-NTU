<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#003060">
    <title>MatchU - è¨»å†Š</title>

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ’–</text></svg>">

    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/components.css">

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        .register-page {
            min-height: 100vh;
            background: var(--bg-secondary);
            padding: var(--space-lg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .register-container {
            width: 100%;
            max-width: 500px;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: var(--space-2xl);
        }

        .register-step {
            display: none;
        }

        .register-step.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-2xl);
        }

        .step-dot {
            width: 10px;
            height: 10px;
            border-radius: var(--radius-full);
            background: var(--bg-tertiary);
            transition: all var(--transition-base);
        }

        .step-dot.active {
            width: 30px;
            background: var(--primary-blue);
        }

        .step-icon {
            font-size: 64px;
            text-align: center;
            margin-bottom: var(--space-lg);
        }

        .step-title {
            font-size: var(--font-h2);
            font-weight: var(--weight-bold);
            text-align: center;
            margin-bottom: var(--space-sm);
        }

        .step-subtitle {
            font-size: var(--font-body);
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: var(--space-xl);
        }

        .form-group {
            margin-bottom: var(--space-lg);
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-sm);
            font-weight: var(--weight-semibold);
            color: var(--text-primary);
        }

        .form-input, .form-select {
            width: 100%;
            padding: var(--space-md);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: var(--font-body);
            transition: all var(--transition-base);
        }

        .form-input:focus, .form-select:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 4px rgba(0, 48, 96, 0.1);
        }

        .form-error {
            color: var(--error);
            font-size: var(--font-body-sm);
            margin-top: var(--space-xs);
            display: none;
        }

        .form-error.show {
            display: block;
        }

        .verification-code {
            display: flex;
            gap: var(--space-sm);
            justify-content: center;
            margin-bottom: var(--space-lg);
        }

        .code-input {
            width: 60px;
            height: 60px;
            text-align: center;
            font-size: var(--font-h3);
            font-weight: var(--weight-bold);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
        }

        .code-input:focus {
            border-color: var(--primary-blue);
        }

        .resend-timer {
            text-align: center;
            color: var(--text-secondary);
            font-size: var(--font-body-sm);
            margin-bottom: var(--space-lg);
        }

        .gender-select {
            display: flex;
            gap: var(--space-md);
        }

        .gender-option {
            flex: 1;
            padding: var(--space-md);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .gender-option:hover {
            border-color: var(--primary-blue);
        }

        .gender-option.selected {
            border-color: var(--primary-blue);
            background: var(--primary-blue);
            color: white;
        }

        .grade-select {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-sm);
        }

        .grade-option {
            padding: var(--space-sm);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-sm);
            text-align: center;
            cursor: pointer;
            font-size: var(--font-body-sm);
            transition: all var(--transition-base);
        }

        .grade-option:hover {
            border-color: var(--primary-blue);
        }

        .grade-option.selected {
            border-color: var(--primary-blue);
            background: var(--primary-blue);
            color: white;
        }

        .photo-upload {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .photo-box {
            aspect-ratio: 1;
            border: 2px dashed var(--border-light);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-base);
            overflow: hidden;
            position: relative;
        }

        .photo-box:hover {
            border-color: var(--primary-blue);
            background: var(--bg-secondary);
        }

        .photo-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-placeholder {
            font-size: 32px;
            color: var(--text-tertiary);
        }

        .interest-categories {
            margin-bottom: var(--space-lg);
        }

        .category-group {
            margin-bottom: var(--space-lg);
        }

        .category-title {
            font-weight: var(--weight-semibold);
            margin-bottom: var(--space-sm);
        }

        .interest-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
        }

        .interest-tag {
            padding: var(--space-sm) var(--space-md);
            background: var(--bg-tertiary);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            cursor: pointer;
            font-size: var(--font-body-sm);
            transition: all var(--transition-base);
        }

        .interest-tag:hover {
            border-color: var(--primary-blue);
        }

        .interest-tag.selected {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        .selected-count {
            text-align: center;
            color: var(--text-secondary);
            font-size: var(--font-body-sm);
            margin-bottom: var(--space-md);
        }

        .btn-group {
            display: flex;
            gap: var(--space-md);
        }
    </style>
</head>
<body>
    <div class="register-page">
        <div class="register-container">
            <!-- Step Indicator -->
            <div class="step-indicator">
                <div class="step-dot active" data-step="1"></div>
                <div class="step-dot" data-step="2"></div>
                <div class="step-dot" data-step="3"></div>
                <div class="step-dot" data-step="4"></div>
                <div class="step-dot" data-step="5"></div>
            </div>

            <!-- Step 1: Email Verification -->
            <div class="register-step active" id="step1">
                <div class="step-icon">âœ‰ï¸</div>
                <h2 class="step-title">ä½¿ç”¨å°å¤§ä¿¡ç®±è¨»å†Š</h2>
                <p class="step-subtitle">åƒ…é™ @ntu.edu.tw ä¿¡ç®±</p>

                <form id="emailForm">
                    <div class="form-group">
                        <label class="form-label">å°å¤§ä¿¡ç®±</label>
                        <input
                            type="email"
                            class="form-input"
                            id="email"
                            placeholder="ä¾‹å¦‚: r12345678@ntu.edu.tw"
                            required
                        >
                        <div class="form-error" id="emailError">è«‹è¼¸å…¥æœ‰æ•ˆçš„å°å¤§ä¿¡ç®±</div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">
                        ç™¼é€é©—è­‰ç¢¼
                    </button>
                </form>

                <div class="text-center mt-lg">
                    <button class="btn btn-text" onclick="window.location.href='../index.html'">
                        è¿”å›é¦–é 
                    </button>
                </div>
            </div>

            <!-- Step 2: Verification Code -->
            <div class="register-step" id="step2">
                <div class="step-icon">ğŸ“§</div>
                <h2 class="step-title">è¼¸å…¥é©—è­‰ç¢¼</h2>
                <p class="step-subtitle">é©—è­‰ç¢¼å·²ç™¼é€è‡³<br><strong id="emailDisplay"></strong></p>

                <div class="verification-code">
                    <input type="text" class="code-input" maxlength="1" data-index="0">
                    <input type="text" class="code-input" maxlength="1" data-index="1">
                    <input type="text" class="code-input" maxlength="1" data-index="2">
                    <input type="text" class="code-input" maxlength="1" data-index="3">
                </div>

                <div class="resend-timer">
                    <span id="timer">60ç§’å¾Œå¯é‡ç™¼</span>
                </div>

                <button class="btn btn-primary btn-block" id="verifyBtn">
                    ç¢ºèª
                </button>
            </div>

            <!-- Step 3: Basic Info -->
            <div class="register-step" id="step3">
                <div class="step-icon">ğŸ‘¤</div>
                <h2 class="step-title">å®Œå–„å€‹äººè³‡æ–™</h2>
                <p class="step-subtitle">æ­¥é©Ÿ 1/3</p>

                <form id="basicInfoForm">
                    <div class="form-group">
                        <label class="form-label">å§“å</label>
                        <input type="text" class="form-input" id="name" placeholder="è«‹è¼¸å…¥çœŸå¯¦å§“å" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">æ€§åˆ¥</label>
                        <div class="gender-select">
                            <div class="gender-option" data-gender="male">
                                <div style="font-size: 32px;">â™‚</div>
                                <div>ç”·ç”Ÿ</div>
                            </div>
                            <div class="gender-option" data-gender="female">
                                <div style="font-size: 32px;">â™€</div>
                                <div>å¥³ç”Ÿ</div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ç”Ÿæ—¥</label>
                        <input type="date" class="form-input" id="birthday" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">å­¸é™¢</label>
                        <select class="form-select" id="college" required>
                            <option value="">é¸æ“‡å­¸é™¢</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ç³»æ‰€</label>
                        <select class="form-select" id="department" required>
                            <option value="">è«‹å…ˆé¸æ“‡å­¸é™¢</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">å¹´ç´š</label>
                        <div class="grade-select">
                            <div class="grade-option" data-grade="å¤§ä¸€">å¤§ä¸€</div>
                            <div class="grade-option" data-grade="å¤§äºŒ">å¤§äºŒ</div>
                            <div class="grade-option" data-grade="å¤§ä¸‰">å¤§ä¸‰</div>
                            <div class="grade-option" data-grade="å¤§å››">å¤§å››</div>
                            <div class="grade-option" data-grade="ç¢©ä¸€">ç¢©ä¸€</div>
                            <div class="grade-option" data-grade="ç¢©äºŒ">ç¢©äºŒ</div>
                            <div class="grade-option" data-grade="åšå£«ç­">åšå£«</div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">
                        ä¸‹ä¸€æ­¥
                    </button>
                </form>
            </div>

            <!-- Step 4: Photos -->
            <div class="register-step" id="step4">
                <div class="step-icon">ğŸ“¸</div>
                <h2 class="step-title">ä¸Šå‚³ä½ çš„ç…§ç‰‡</h2>
                <p class="step-subtitle">æ­¥é©Ÿ 2/3 (è‡³å°‘2å¼µ)</p>

                <div class="photo-upload">
                    <div class="photo-box" data-index="0">
                        <div class="photo-placeholder">+</div>
                    </div>
                    <div class="photo-box" data-index="1">
                        <div class="photo-placeholder">+</div>
                    </div>
                    <div class="photo-box" data-index="2">
                        <div class="photo-placeholder">+</div>
                    </div>
                    <div class="photo-box" data-index="3">
                        <div class="photo-placeholder">+</div>
                    </div>
                    <div class="photo-box" data-index="4">
                        <div class="photo-placeholder">+</div>
                    </div>
                    <div class="photo-box" data-index="5">
                        <div class="photo-placeholder">+</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">å€‹äººç°¡ä»‹ (100å­—ä»¥å…§)</label>
                    <textarea class="input" id="bio" rows="4" placeholder="åˆ†äº«ä½ çš„å€‹æ€§ã€èˆˆè¶£ã€æˆ–æƒ³å°é…å°å°è±¡èªªçš„è©±..."></textarea>
                    <div class="text-right" style="font-size: var(--font-body-sm); color: var(--text-tertiary); margin-top: var(--space-xs);">
                        <span id="bioCount">0</span> / 100
                    </div>
                </div>

                <button class="btn btn-primary btn-block" onclick="goToStep(5)">
                    ä¸‹ä¸€æ­¥
                </button>
            </div>

            <!-- Step 5: Interests -->
            <div class="register-step" id="step5">
                <div class="step-icon">ğŸ·ï¸</div>
                <h2 class="step-title">é¸æ“‡ä½ çš„èˆˆè¶£</h2>
                <p class="step-subtitle">æ­¥é©Ÿ 3/3 (é¸æ“‡3-10å€‹)</p>

                <div class="selected-count">
                    å·²é¸æ“‡: <strong id="interestCount">0</strong> / 10
                </div>

                <div class="interest-categories" id="interestCategories">
                    <!-- Will be dynamically filled -->
                </div>

                <button class="btn btn-primary btn-block" id="completeBtn" disabled>
                    å®Œæˆè¨»å†Š
                </button>
            </div>
        </div>
    </div>

    <script src="../js/config.js"></script>
    <script src="../js/utils.js"></script>

    <script>
        let currentStep = 1;
        let userData = {};
        let selectedGender = '';
        let selectedGrade = '';
        let selectedInterests = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeRegister();
        });

        function initializeRegister() {
            // Load colleges
            loadColleges();

            // Setup event listeners
            setupEmailForm();
            setupVerificationCode();
            setupBasicInfoForm();
            setupGenderSelect();
            setupGradeSelect();
            setupPhotoUpload();
            setupBioCounter();
            setupInterests();
        }

        function setupEmailForm() {
            document.getElementById('emailForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('email').value;

                if (Utils.isValidNTUEmail(email)) {
                    userData.email = email;
                    document.getElementById('emailDisplay').textContent = email;
                    Utils.showLoading('ç™¼é€é©—è­‰ç¢¼ä¸­...');

                    setTimeout(() => {
                        Utils.hideLoading();
                        Utils.showToast('é©—è­‰ç¢¼å·²ç™¼é€!', 'success');
                        goToStep(2);
                        startTimer();
                    }, 1000);
                } else {
                    document.getElementById('emailError').classList.add('show');
                }
            });
        }

        function setupVerificationCode() {
            const inputs = document.querySelectorAll('.code-input');

            inputs.forEach((input, index) => {
                input.addEventListener('input', (e) => {
                    if (e.target.value.length === 1 && index < inputs.length - 1) {
                        inputs[index + 1].focus();
                    }

                    // Auto verify when all filled
                    if (index === inputs.length - 1 && e.target.value.length === 1) {
                        verifyCode();
                    }
                });

                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && e.target.value === '' && index > 0) {
                        inputs[index - 1].focus();
                    }
                });
            });

            document.getElementById('verifyBtn').addEventListener('click', verifyCode);
        }

        function verifyCode() {
            const inputs = document.querySelectorAll('.code-input');
            const code = Array.from(inputs).map(input => input.value).join('');

            if (code.length === 4) {
                Utils.showLoading('é©—è­‰ä¸­...');
                setTimeout(() => {
                    Utils.hideLoading();
                    Utils.showToast('é©—è­‰æˆåŠŸ!', 'success');
                    goToStep(3);
                }, 1000);
            }
        }

        function startTimer() {
            let seconds = 60;
            const timerEl = document.getElementById('timer');

            const interval = setInterval(() => {
                seconds--;
                timerEl.textContent = `${seconds}ç§’å¾Œå¯é‡ç™¼`;

                if (seconds === 0) {
                    clearInterval(interval);
                    timerEl.innerHTML = '<button class="btn btn-text">é‡æ–°ç™¼é€</button>';
                }
            }, 1000);
        }

        function loadColleges() {
            const collegeSelect = document.getElementById('college');
            COLLEGES.forEach(college => {
                const option = document.createElement('option');
                option.value = college.name;
                option.textContent = college.name;
                collegeSelect.appendChild(option);
            });

            collegeSelect.addEventListener('change', (e) => {
                loadDepartments(e.target.value);
            });
        }

        function loadDepartments(collegeName) {
            const college = COLLEGES.find(c => c.name === collegeName);
            const departmentSelect = document.getElementById('department');

            departmentSelect.innerHTML = '<option value="">é¸æ“‡ç³»æ‰€</option>';

            if (college) {
                college.departments.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept;
                    option.textContent = dept;
                    departmentSelect.appendChild(option);
                });
            }
        }

        function setupBasicInfoForm() {
            document.getElementById('basicInfoForm').addEventListener('submit', (e) => {
                e.preventDefault();

                userData.name = document.getElementById('name').value;
                userData.gender = selectedGender;
                userData.birthday = document.getElementById('birthday').value;
                userData.college = document.getElementById('college').value;
                userData.department = document.getElementById('department').value;
                userData.grade = selectedGrade;

                if (!userData.gender || !userData.grade) {
                    Utils.showToast('è«‹å®Œæ•´å¡«å¯«æ‰€æœ‰è³‡æ–™', 'error');
                    return;
                }

                goToStep(4);
            });
        }

        function setupGenderSelect() {
            document.querySelectorAll('.gender-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelectorAll('.gender-option').forEach(o => o.classList.remove('selected'));
                    option.classList.add('selected');
                    selectedGender = option.dataset.gender;
                });
            });
        }

        function setupGradeSelect() {
            document.querySelectorAll('.grade-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelectorAll('.grade-option').forEach(o => o.classList.remove('selected'));
                    option.classList.add('selected');
                    selectedGrade = option.dataset.grade;
                });
            });
        }

        function setupPhotoUpload() {
            document.querySelectorAll('.photo-box').forEach(box => {
                box.addEventListener('click', () => {
                    // æ¨¡æ“¬ç…§ç‰‡ä¸Šå‚³
                    const photos = [
                        'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=400',
                        'https://images.unsplash.com/photo-1517841905240-472988babdf9?w=400',
                        'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=400'
                    ];
                    const randomPhoto = Utils.randomPick(photos);

                    box.innerHTML = `<img src="${randomPhoto}" alt="ç…§ç‰‡">`;
                    Utils.showToast('ç…§ç‰‡å·²ä¸Šå‚³', 'success');
                });
            });
        }

        function setupBioCounter() {
            const bioInput = document.getElementById('bio');
            const counter = document.getElementById('bioCount');

            bioInput.addEventListener('input', () => {
                const length = bioInput.value.length;
                counter.textContent = length;

                if (length > 100) {
                    bioInput.value = bioInput.value.slice(0, 100);
                    counter.textContent = 100;
                }
            });
        }

        function setupInterests() {
            const container = document.getElementById('interestCategories');

            Object.entries(INTEREST_CATEGORIES).forEach(([key, category]) => {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'category-group';

                groupDiv.innerHTML = `
                    <div class="category-title">${category.name}</div>
                    <div class="interest-tags">
                        ${category.tags.map(tag => `
                            <div class="interest-tag" data-interest="${tag}">${tag}</div>
                        `).join('')}
                    </div>
                `;

                container.appendChild(groupDiv);
            });

            // Add click handlers
            document.querySelectorAll('.interest-tag').forEach(tag => {
                tag.addEventListener('click', () => {
                    const interest = tag.dataset.interest;

                    if (tag.classList.contains('selected')) {
                        tag.classList.remove('selected');
                        selectedInterests = selectedInterests.filter(i => i !== interest);
                    } else {
                        if (selectedInterests.length < 10) {
                            tag.classList.add('selected');
                            selectedInterests.push(interest);
                        } else {
                            Utils.showToast('æœ€å¤šåªèƒ½é¸æ“‡10å€‹èˆˆè¶£', 'warning');
                        }
                    }

                    updateInterestCount();
                });
            });
        }

        function updateInterestCount() {
            document.getElementById('interestCount').textContent = selectedInterests.length;
            document.getElementById('completeBtn').disabled = selectedInterests.length < 3;
        }

        function goToStep(step) {
            // Hide current step
            document.querySelectorAll('.register-step').forEach(s => s.classList.remove('active'));

            // Show new step
            document.getElementById(`step${step}`).classList.add('active');

            // Update indicators
            document.querySelectorAll('.step-dot').forEach((dot, index) => {
                if (index < step) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });

            currentStep = step;

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        document.getElementById('completeBtn').addEventListener('click', () => {
            userData.interests = selectedInterests;

            Utils.showLoading('æ­£åœ¨å‰µå»ºæ‚¨çš„å¸³è™Ÿ...');

            setTimeout(() => {
                Utils.hideLoading();
                Utils.showToast('è¨»å†ŠæˆåŠŸ!æ­¡è¿åŠ å…¥ MatchU!', 'success', 3000);

                setTimeout(() => {
                    window.location.href = 'swipe.html';
                }, 1000);
            }, 2000);
        });
    </script>
</body>
</html>
