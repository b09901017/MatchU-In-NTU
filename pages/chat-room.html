<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#003060">
    <title>MatchU - 聊天室</title>

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>💖</text></svg>">

    <!-- CSS -->
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/pages/chat-room.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

</head>
<body>
    <div class="chat-room-page">
        <!-- Top Navigation -->
        <div class="top-nav">
            <div class="top-nav-left">
                <button class="btn-icon" onclick="window.location.href='chat-list.html'">
                    <span>←</span>
                </button>
                <img id="partnerAvatar" src="" alt="聊天對象" class="avatar avatar-sm">
                <div>
                    <div class="top-nav-title" id="partnerName">載入中...</div>
                    <div id="partnerStatus" style="font-size: 12px; color: var(--text-tertiary);"></div>
                </div>
            </div>
            <div class="top-nav-right">
                <button class="btn-icon" onclick="showChatMenu()">
                    <span>⋮</span>
                </button>
            </div>
        </div>

        <!-- Messages Area -->
        <div class="messages-area" id="messagesArea">
            <!-- Messages will be dynamically inserted here -->
        </div>

        <!-- Input Area -->
        <div class="input-area">
            <div class="input-wrapper">
                <textarea
                    id="messageInput"
                    class="message-input"
                    placeholder="輸入訊息..."
                    rows="1"
                ></textarea>
                <div class="plus-btn" id="plusBtn">+</div>

                <!-- Plus Menu -->
                <div class="plus-menu" id="plusMenu">
                    <div class="menu-item" onclick="openInvitationModal()">
                        <span>📅</span>
                        <span>發起邀約</span>
                    </div>
                    <div class="menu-item" onclick="startIcebreakerGame()">
                        <span>🎮</span>
                        <span>破冰遊戲</span>
                    </div>
                    <div class="menu-item" onclick="sendSticker()">
                        <span>🎨</span>
                        <span>貼圖</span>
                    </div>
                </div>
            </div>
            <button class="send-btn" id="sendBtn" disabled>
                <span>➤</span>
            </button>
        </div>
    </div>

    <!-- Invitation Modal -->
    <div class="invitation-modal" id="invitationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">發起邀約</h3>
                <button class="modal-close" onclick="closeInvitationModal()">✕</button>
            </div>

            <form id="invitationForm">
                <div class="form-group">
                    <label class="form-label">活動類型</label>
                    <select class="form-select" id="activityType" onchange="updateLocationSuggestions()">
                        <option value="">選擇活動類型</option>
                        <option value="coffee">☕ 一起喝咖啡</option>
                        <option value="movie">🎬 一起看電影</option>
                        <option value="study">📚 一起讀書</option>
                        <option value="meal">🍜 一起吃飯</option>
                        <option value="hiking">⛰️ 一起爬山</option>
                        <option value="sports">🏀 一起運動</option>
                        <option value="exhibition">🎨 一起看展覽</option>
                        <option value="boardgame">🎮 一起玩桌遊</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">時間</label>
                    <input type="datetime-local" class="form-input" id="activityTime" required>
                </div>

                <div class="form-group">
                    <label class="form-label">地點</label>
                    <input type="text" class="form-input" id="activityLocation" placeholder="輸入地點或選擇建議" required>
                    <div id="locationSuggestions" style="margin-top: var(--space-xs); font-size: var(--font-body-sm); color: var(--text-secondary);"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">備註 (可選)</label>
                    <textarea class="form-textarea" id="activityNote" placeholder="說點什麼..."></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeInvitationModal()">取消</button>
                    <button type="submit" class="btn btn-coral">發送邀約</button>
                </div>
            </form>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="../js/config.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/components.js"></script>
    <script src="../js/pages/chat-room.js"></script>

</body>
</html>
