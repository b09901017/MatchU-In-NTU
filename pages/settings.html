<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#003060">
    <title>MatchU - Ë®≠ÂÆö</title>

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üíñ</text></svg>">

    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/components.css">

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        .settings-page {
            background: var(--bg-secondary);
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .settings-header {
            background: var(--gradient-primary);
            padding: var(--space-lg) var(--space-md);
            color: white;
        }

        .settings-subtitle {
            font-size: var(--font-body-sm);
            opacity: 0.9;
            margin-top: var(--space-xs);
        }

        .settings-section {
            margin-top: var(--space-md);
            background: white;
        }

        .settings-group-title {
            padding: var(--space-md);
            font-size: var(--font-body-sm);
            color: var(--text-secondary);
            font-weight: var(--weight-semibold);
            background: var(--bg-secondary);
        }

        .settings-item {
            padding: var(--space-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border-light);
            cursor: pointer;
            transition: background var(--transition-base);
        }

        .settings-item:hover {
            background: var(--bg-secondary);
        }

        .settings-item:active {
            background: var(--bg-tertiary);
        }

        .settings-item-left {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            flex: 1;
        }

        .settings-item-icon {
            font-size: 24px;
            width: 32px;
            text-align: center;
        }

        .settings-item-content {
            flex: 1;
        }

        .settings-item-label {
            font-size: var(--font-body);
            color: var(--text-primary);
            margin-bottom: var(--space-xs);
        }

        .settings-item-description {
            font-size: var(--font-body-sm);
            color: var(--text-tertiary);
        }

        .settings-item-value {
            color: var(--text-secondary);
            font-size: var(--font-body-sm);
            margin-right: var(--space-sm);
        }

        .settings-item-arrow {
            color: var(--text-tertiary);
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 28px;
            background: var(--border-color);
            border-radius: 14px;
            cursor: pointer;
            transition: background var(--transition-base);
        }

        .toggle-switch.active {
            background: var(--primary-blue);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform var(--transition-base);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active::after {
            transform: translateX(22px);
        }

        /* Range Slider */
        .range-slider-container {
            padding: var(--space-md);
            background: var(--bg-secondary);
        }

        .range-slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--space-sm);
            font-size: var(--font-body-sm);
            color: var(--text-secondary);
        }

        .range-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--border-color);
            outline: none;
            -webkit-appearance: none;
        }

        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-blue);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .range-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-blue);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .danger-zone {
            margin: var(--space-lg);
        }

        .danger-zone-title {
            color: var(--error);
            font-weight: var(--weight-semibold);
            margin-bottom: var(--space-md);
        }

        .delete-account-btn {
            background: var(--error);
            color: white;
        }

        .delete-account-btn:hover {
            background: var(--error-bg);
            color: var(--error);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: var(--font-h3);
            font-weight: var(--weight-semibold);
            margin-bottom: var(--space-md);
        }

        .modal-body {
            margin-bottom: var(--space-lg);
        }

        .modal-actions {
            display: flex;
            gap: var(--space-sm);
        }

        .form-group {
            margin-bottom: var(--space-md);
        }

        .form-label {
            display: block;
            font-size: var(--font-body-sm);
            color: var(--text-secondary);
            margin-bottom: var(--space-xs);
        }

        .form-input {
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: var(--font-body);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-blue);
        }

        .preference-option {
            padding: var(--space-sm) var(--space-md);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-sm);
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .preference-option:hover {
            border-color: var(--primary-blue);
            background: var(--bg-secondary);
        }

        .preference-option.selected {
            border-color: var(--primary-blue);
            background: var(--primary-light);
        }

        .preference-option input[type="checkbox"],
        .preference-option input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="settings-page page-with-nav">
        <div class="top-nav">
            <div class="top-nav-left">
                <button class="btn-icon" onclick="window.history.back()">
                    <span>‚Üê</span>
                </button>
                <div class="top-nav-title">Ë®≠ÂÆö</div>
            </div>
        </div>

        <!-- Account Settings -->
        <div class="settings-section">
            <div class="settings-group-title">Â∏≥ËôüË®≠ÂÆö</div>
            <div class="settings-item" onclick="openEmailModal()">
                <div class="settings-item-left">
                    <div class="settings-item-icon">üìß</div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">ÈõªÂ≠êÈÉµ‰ª∂</div>
                        <div class="settings-item-description" id="currentEmail">b12345678@ntu.edu.tw</div>
                    </div>
                </div>
                <div class="settings-item-arrow">‚Üí</div>
            </div>
            <div class="settings-item" onclick="openPasswordModal()">
                <div class="settings-item-left">
                    <div class="settings-item-icon">üîí</div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Êõ¥ÊîπÂØÜÁ¢º</div>
                    </div>
                </div>
                <div class="settings-item-arrow">‚Üí</div>
            </div>
        </div>

        <!-- Privacy Settings -->
        <div class="settings-section">
            <div class="settings-group-title">Èö±ÁßÅË®≠ÂÆö</div>
            <div class="settings-item" onclick="toggleSetting('profileVisibility', this)">
                <div class="settings-item-left">
                    <div class="settings-item-icon">üëÅÔ∏è</div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">È°ØÁ§∫ÂÄã‰∫∫Ê™îÊ°à</div>
                        <div class="settings-item-description">ËÆìÂÖ∂‰ªñ‰∫∫ÁúãË¶ã‰Ω†ÁöÑÂÄã‰∫∫Ê™îÊ°à</div>
                    </div>
                </div>
                <div class="toggle-switch active" data-setting="profileVisibility"></div>
            </div>
            <div class="settings-item" onclick="toggleSetting('onlineStatus', this)">
                <div class="settings-item-left">
                    <div class="settings-item-icon">üü¢</div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">È°ØÁ§∫‰∏äÁ∑öÁãÄÊÖã</div>
                        <div class="settings-item-description">ËÆìÈÖçÂ∞çÂ∞çË±°ÁúãË¶ã‰Ω†ÊòØÂê¶Âú®Á∑ö‰∏ä</div>
                    </div>
                </div>
                <div class="toggle-switch active" data-setting="onlineStatus"></div>
            </div>
            <div class="settings-item" onclick="toggleSetting('readReceipts', this)">
                <div class="settings-item-left">
                    <div class="settings-item-icon">‚úì‚úì</div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Â∑≤ËÆÄÂõûÊ¢ù</div>
                        <div class="settings-item-description">ËÆìÂ∞çÊñπÁü•ÈÅì‰Ω†Â∑≤ËÆÄË®äÊÅØ</div>
                    </div>
                </div>
                <div class="toggle-switch active" data-setting="readReceipts"></div>
            </div>
        </div>

        <!-- Notification Settings -->
        <div class="settings-section">
            <div class="settings-group-title">ÈÄöÁü•Ë®≠ÂÆö</div>
            <div class="settings-item" onclick="toggleSetting('matchNotifications', this)">
                <div class="settings-item-left">
                    <div class="settings-item-icon">üíñ</div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">ÈÖçÂ∞çÈÄöÁü•</div>
                        <div class="settings-item-description">Áï∂ÈÖçÂ∞çÊàêÂäüÊôÇÈÄöÁü•‰Ω†</div>
                    </div>
                </div>
                <div class="toggle-switch active" data-setting="matchNotifications"></div>
            </div>
            <div class="settings-item" onclick="toggleSetting('messageNotifications', this)">
                <div class="settings-item-left">
                    <div class="settings-item-icon">üí¨</div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Ë®äÊÅØÈÄöÁü•</div>
                        <div class="settings-item-description">Áï∂Êî∂Âà∞Êñ∞Ë®äÊÅØÊôÇÈÄöÁü•‰Ω†</div>
                    </div>
                </div>
                <div class="toggle-switch active" data-setting="messageNotifications"></div>
            </div>
            <div class="settings-item" onclick="toggleSetting('activityNotifications', this)">
                <div class="settings-item-left">
                    <div class="settings-item-icon">üéâ</div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Ê¥ªÂãïÈÇÄÁ¥ÑÈÄöÁü•</div>
                        <div class="settings-item-description">Áï∂ÊúâÊ¥ªÂãïÈÇÄÁ¥ÑÊôÇÈÄöÁü•‰Ω†</div>
                    </div>
                </div>
                <div class="toggle-switch active" data-setting="activityNotifications"></div>
            </div>
        </div>

        <!-- Matching Preferences -->
        <div class="settings-section">
            <div class="settings-group-title">ÈÖçÂ∞çÂÅèÂ•Ω</div>
            <div class="settings-item" onclick="openGenderPreferenceModal()">
                <div class="settings-item-left">
                    <div class="settings-item-icon">‚ößÔ∏è</div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">ÊÄßÂà•ÂÅèÂ•Ω</div>
                    </div>
                </div>
                <div class="settings-item-value" id="genderPreference">ÂÖ®ÈÉ®</div>
                <div class="settings-item-arrow">‚Üí</div>
            </div>
            <div class="settings-item" onclick="openAgeRangeModal()">
                <div class="settings-item-left">
                    <div class="settings-item-icon">üéÇ</div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Âπ¥ÈΩ°ÁØÑÂúç</div>
                    </div>
                </div>
                <div class="settings-item-value" id="ageRange">18 - 30 Ê≠≤</div>
                <div class="settings-item-arrow">‚Üí</div>
            </div>
            <div class="settings-item" onclick="openDistanceModal()">
                <div class="settings-item-left">
                    <div class="settings-item-icon">üìç</div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Ê¥ªÂãïË∑ùÈõ¢ÁØÑÂúç</div>
                        <div class="settings-item-description">ÊêúÂ∞ãÊ¥ªÂãïÁöÑÊúÄÂ§ßË∑ùÈõ¢</div>
                    </div>
                </div>
                <div class="settings-item-value" id="distance">5 ÂÖ¨Èáå</div>
                <div class="settings-item-arrow">‚Üí</div>
            </div>
        </div>

        <!-- Other Settings -->
        <div class="settings-section">
            <div class="settings-group-title">ÂÖ∂‰ªñ</div>
            <div class="settings-item" onclick="Utils.showToast('ÂäüËÉΩÈñãÁôº‰∏≠', 'info')">
                <div class="settings-item-left">
                    <div class="settings-item-icon">üö´</div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Â∞ÅÈéñÂêçÂñÆ</div>
                    </div>
                </div>
                <div class="settings-item-arrow">‚Üí</div>
            </div>
            <div class="settings-item" onclick="Utils.showToast('ÂäüËÉΩÈñãÁôº‰∏≠', 'info')">
                <div class="settings-item-left">
                    <div class="settings-item-icon">‚ùì</div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Âπ´Âä©ËàáÊîØÊè¥</div>
                    </div>
                </div>
                <div class="settings-item-arrow">‚Üí</div>
            </div>
            <div class="settings-item" onclick="Utils.showToast('ÂäüËÉΩÈñãÁôº‰∏≠', 'info')">
                <div class="settings-item-left">
                    <div class="settings-item-icon">üìÑ</div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">ÊúçÂãôÊ¢ùÊ¨æ</div>
                    </div>
                </div>
                <div class="settings-item-arrow">‚Üí</div>
            </div>
            <div class="settings-item" onclick="Utils.showToast('ÂäüËÉΩÈñãÁôº‰∏≠', 'info')">
                <div class="settings-item-left">
                    <div class="settings-item-icon">üîê</div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">Èö±ÁßÅÊîøÁ≠ñ</div>
                    </div>
                </div>
                <div class="settings-item-arrow">‚Üí</div>
            </div>
            <div class="settings-item" onclick="Utils.showToast('ÂäüËÉΩÈñãÁôº‰∏≠', 'info')">
                <div class="settings-item-left">
                    <div class="settings-item-icon">‚ÑπÔ∏è</div>
                    <div class="settings-item-content">
                        <div class="settings-item-label">ÈóúÊñº MatchU</div>
                        <div class="settings-item-description">ÁâàÊú¨ 1.0.0</div>
                    </div>
                </div>
                <div class="settings-item-arrow">‚Üí</div>
            </div>
        </div>

        <!-- Danger Zone -->
        <div class="danger-zone">
            <div class="danger-zone-title">Âç±Èö™ÂçÄÂüü</div>
            <button class="btn btn-block delete-account-btn" onclick="confirmDeleteAccount()">
                Âà™Èô§Â∏≥Ëôü
            </button>
        </div>
    </div>

    <!-- Email Modal -->
    <div class="modal" id="emailModal">
        <div class="modal-content">
            <div class="modal-header">Êõ¥ÊîπÈõªÂ≠êÈÉµ‰ª∂</div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Êñ∞ÁöÑ NTU ÈõªÂ≠êÈÉµ‰ª∂</label>
                    <input type="email" class="form-input" id="newEmail" placeholder="b12345678@ntu.edu.tw">
                </div>
                <div class="form-group">
                    <label class="form-label">Á¢∫Ë™çÂØÜÁ¢º</label>
                    <input type="password" class="form-input" id="confirmPassword" placeholder="Ëº∏ÂÖ•ÂØÜÁ¢º‰ª•Á¢∫Ë™çËÆäÊõ¥">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary flex-1" onclick="closeModal('emailModal')">ÂèñÊ∂à</button>
                <button class="btn btn-primary flex-1" onclick="updateEmail()">Á¢∫Ë™ç</button>
            </div>
        </div>
    </div>

    <!-- Password Modal -->
    <div class="modal" id="passwordModal">
        <div class="modal-content">
            <div class="modal-header">Êõ¥ÊîπÂØÜÁ¢º</div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ÁõÆÂâçÂØÜÁ¢º</label>
                    <input type="password" class="form-input" id="currentPassword" placeholder="Ëº∏ÂÖ•ÁõÆÂâçÂØÜÁ¢º">
                </div>
                <div class="form-group">
                    <label class="form-label">Êñ∞ÂØÜÁ¢º</label>
                    <input type="password" class="form-input" id="newPassword" placeholder="Ëá≥Â∞ë 8 ÂÄãÂ≠óÂÖÉ">
                </div>
                <div class="form-group">
                    <label class="form-label">Á¢∫Ë™çÊñ∞ÂØÜÁ¢º</label>
                    <input type="password" class="form-input" id="confirmNewPassword" placeholder="ÂÜçÊ¨°Ëº∏ÂÖ•Êñ∞ÂØÜÁ¢º">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary flex-1" onclick="closeModal('passwordModal')">ÂèñÊ∂à</button>
                <button class="btn btn-primary flex-1" onclick="updatePassword()">Á¢∫Ë™ç</button>
            </div>
        </div>
    </div>

    <!-- Gender Preference Modal -->
    <div class="modal" id="genderPreferenceModal">
        <div class="modal-content">
            <div class="modal-header">ÊÄßÂà•ÂÅèÂ•Ω</div>
            <div class="modal-body">
                <div class="preference-option selected" data-value="all">
                    <input type="radio" name="gender" value="all" checked>
                    <label>ÂÖ®ÈÉ®</label>
                </div>
                <div class="preference-option" data-value="male">
                    <input type="radio" name="gender" value="male">
                    <label>Áî∑ÊÄß</label>
                </div>
                <div class="preference-option" data-value="female">
                    <input type="radio" name="gender" value="female">
                    <label>Â•≥ÊÄß</label>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary flex-1" onclick="closeModal('genderPreferenceModal')">ÂèñÊ∂à</button>
                <button class="btn btn-primary flex-1" onclick="updateGenderPreference()">Á¢∫Ë™ç</button>
            </div>
        </div>
    </div>

    <!-- Age Range Modal -->
    <div class="modal" id="ageRangeModal">
        <div class="modal-content">
            <div class="modal-header">Âπ¥ÈΩ°ÁØÑÂúç</div>
            <div class="modal-body">
                <div class="range-slider-container">
                    <div class="range-slider-label">
                        <span>ÊúÄÂ∞èÂπ¥ÈΩ°</span>
                        <span id="minAgeValue">18</span>
                    </div>
                    <input type="range" class="range-slider" id="minAge" min="18" max="50" value="18" oninput="updateAgeRange()">
                </div>
                <div class="range-slider-container">
                    <div class="range-slider-label">
                        <span>ÊúÄÂ§ßÂπ¥ÈΩ°</span>
                        <span id="maxAgeValue">30</span>
                    </div>
                    <input type="range" class="range-slider" id="maxAge" min="18" max="50" value="30" oninput="updateAgeRange()">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary flex-1" onclick="closeModal('ageRangeModal')">ÂèñÊ∂à</button>
                <button class="btn btn-primary flex-1" onclick="saveAgeRange()">Á¢∫Ë™ç</button>
            </div>
        </div>
    </div>

    <!-- Distance Modal -->
    <div class="modal" id="distanceModal">
        <div class="modal-content">
            <div class="modal-header">Ê¥ªÂãïË∑ùÈõ¢ÁØÑÂúç</div>
            <div class="modal-body">
                <div class="range-slider-container">
                    <div class="range-slider-label">
                        <span>ÊúÄÂ§ßË∑ùÈõ¢</span>
                        <span id="distanceValue">5 ÂÖ¨Èáå</span>
                    </div>
                    <input type="range" class="range-slider" id="distanceSlider" min="1" max="20" value="5" oninput="updateDistanceValue()">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary flex-1" onclick="closeModal('distanceModal')">ÂèñÊ∂à</button>
                <button class="btn btn-primary flex-1" onclick="saveDistance()">Á¢∫Ë™ç</button>
            </div>
        </div>
    </div>

    <script src="../js/config.js"></script>
    <script src="../js/utils.js"></script>

    <script>
        // Settings state
        const settings = {
            profileVisibility: true,
            onlineStatus: true,
            readReceipts: true,
            matchNotifications: true,
            messageNotifications: true,
            activityNotifications: true,
            genderPreference: 'all',
            minAge: 18,
            maxAge: 30,
            distance: 5
        };

        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            animateEntrance();
        });

        function loadSettings() {
            // Load from localStorage if exists
            const saved = localStorage.getItem('matchuSettings');
            if (saved) {
                Object.assign(settings, JSON.parse(saved));
            }
            updateUI();
        }

        function updateUI() {
            document.getElementById('genderPreference').textContent =
                settings.genderPreference === 'all' ? 'ÂÖ®ÈÉ®' :
                settings.genderPreference === 'male' ? 'Áî∑ÊÄß' : 'Â•≥ÊÄß';

            document.getElementById('ageRange').textContent =
                `${settings.minAge} - ${settings.maxAge} Ê≠≤`;

            document.getElementById('distance').textContent =
                `${settings.distance} ÂÖ¨Èáå`;
        }

        function saveSettings() {
            localStorage.setItem('matchuSettings', JSON.stringify(settings));
        }

        function toggleSetting(key, element) {
            const toggle = element.querySelector('.toggle-switch');
            settings[key] = !settings[key];
            toggle.classList.toggle('active');
            saveSettings();

            gsap.to(toggle, {
                duration: 0.2,
                scale: 1.1,
                yoyo: true,
                repeat: 1,
                ease: 'power2.inOut'
            });
        }

        // Modal functions
        function openEmailModal() {
            document.getElementById('emailModal').classList.add('show');
            animateModal('emailModal');
        }

        function openPasswordModal() {
            document.getElementById('passwordModal').classList.add('show');
            animateModal('passwordModal');
        }

        function openGenderPreferenceModal() {
            document.getElementById('genderPreferenceModal').classList.add('show');
            animateModal('genderPreferenceModal');

            // Set current selection
            document.querySelectorAll('#genderPreferenceModal .preference-option').forEach(option => {
                const radio = option.querySelector('input');
                if (radio.value === settings.genderPreference) {
                    option.classList.add('selected');
                    radio.checked = true;
                } else {
                    option.classList.remove('selected');
                }
            });

            // Add click handlers
            document.querySelectorAll('#genderPreferenceModal .preference-option').forEach(option => {
                option.onclick = () => {
                    document.querySelectorAll('#genderPreferenceModal .preference-option').forEach(o =>
                        o.classList.remove('selected'));
                    option.classList.add('selected');
                    option.querySelector('input').checked = true;
                };
            });
        }

        function openAgeRangeModal() {
            document.getElementById('ageRangeModal').classList.add('show');
            animateModal('ageRangeModal');

            // Set current values
            document.getElementById('minAge').value = settings.minAge;
            document.getElementById('maxAge').value = settings.maxAge;
            document.getElementById('minAgeValue').textContent = settings.minAge;
            document.getElementById('maxAgeValue').textContent = settings.maxAge;
        }

        function openDistanceModal() {
            document.getElementById('distanceModal').classList.add('show');
            animateModal('distanceModal');

            // Set current value
            document.getElementById('distanceSlider').value = settings.distance;
            document.getElementById('distanceValue').textContent = `${settings.distance} ÂÖ¨Èáå`;
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            gsap.to(modal.querySelector('.modal-content'), {
                duration: 0.2,
                scale: 0.9,
                opacity: 0,
                onComplete: () => {
                    modal.classList.remove('show');
                }
            });
        }

        function animateModal(modalId) {
            const content = document.getElementById(modalId).querySelector('.modal-content');
            gsap.from(content, {
                duration: 0.3,
                scale: 0.9,
                opacity: 0,
                ease: 'back.out(1.7)'
            });
        }

        // Update functions
        function updateEmail() {
            const newEmail = document.getElementById('newEmail').value;
            const password = document.getElementById('confirmPassword').value;

            if (!Utils.isValidNTUEmail(newEmail)) {
                Utils.showToast('Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑÂè∞Â§ß‰ø°ÁÆ±', 'error');
                return;
            }

            if (!password) {
                Utils.showToast('Ë´ãËº∏ÂÖ•ÂØÜÁ¢º‰ª•Á¢∫Ë™çËÆäÊõ¥', 'error');
                return;
            }

            Utils.showLoading('Êõ¥Êñ∞‰∏≠...');
            setTimeout(() => {
                Utils.hideLoading();
                document.getElementById('currentEmail').textContent = newEmail;
                closeModal('emailModal');
                Utils.showToast('ÈõªÂ≠êÈÉµ‰ª∂Â∑≤Êõ¥Êñ∞', 'success');
            }, 1000);
        }

        function updatePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmNewPassword').value;

            if (!current || !newPass || !confirm) {
                Utils.showToast('Ë´ãÂ°´ÂØ´ÊâÄÊúâÊ¨Ñ‰Ωç', 'error');
                return;
            }

            if (newPass.length < 8) {
                Utils.showToast('Êñ∞ÂØÜÁ¢ºËá≥Â∞ëÈúÄË¶Å 8 ÂÄãÂ≠óÂÖÉ', 'error');
                return;
            }

            if (newPass !== confirm) {
                Utils.showToast('Êñ∞ÂØÜÁ¢º‰∏ç‰∏ÄËá¥', 'error');
                return;
            }

            Utils.showLoading('Êõ¥Êñ∞‰∏≠...');
            setTimeout(() => {
                Utils.hideLoading();
                closeModal('passwordModal');
                Utils.showToast('ÂØÜÁ¢ºÂ∑≤Êõ¥Êñ∞', 'success');
            }, 1000);
        }

        function updateGenderPreference() {
            const selected = document.querySelector('#genderPreferenceModal input:checked').value;
            settings.genderPreference = selected;
            saveSettings();
            updateUI();
            closeModal('genderPreferenceModal');
            Utils.showToast('ÊÄßÂà•ÂÅèÂ•ΩÂ∑≤Êõ¥Êñ∞', 'success');
        }

        function updateAgeRange() {
            const minAge = parseInt(document.getElementById('minAge').value);
            const maxAge = parseInt(document.getElementById('maxAge').value);

            // Ensure min is not greater than max
            if (minAge > maxAge) {
                document.getElementById('maxAge').value = minAge;
            }

            document.getElementById('minAgeValue').textContent = document.getElementById('minAge').value;
            document.getElementById('maxAgeValue').textContent = document.getElementById('maxAge').value;
        }

        function saveAgeRange() {
            settings.minAge = parseInt(document.getElementById('minAge').value);
            settings.maxAge = parseInt(document.getElementById('maxAge').value);
            saveSettings();
            updateUI();
            closeModal('ageRangeModal');
            Utils.showToast('Âπ¥ÈΩ°ÁØÑÂúçÂ∑≤Êõ¥Êñ∞', 'success');
        }

        function updateDistanceValue() {
            const value = document.getElementById('distanceSlider').value;
            document.getElementById('distanceValue').textContent = `${value} ÂÖ¨Èáå`;
        }

        function saveDistance() {
            settings.distance = parseInt(document.getElementById('distanceSlider').value);
            saveSettings();
            updateUI();
            closeModal('distanceModal');
            Utils.showToast('Ë∑ùÈõ¢ÁØÑÂúçÂ∑≤Êõ¥Êñ∞', 'success');
        }

        function confirmDeleteAccount() {
            Utils.showConfirm(
                'Á¢∫ÂÆöË¶ÅÂà™Èô§Â∏≥ËôüÂóé? Ê≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©Âéü,ÊâÄÊúâË≥áÊñôÂ∞áË¢´Ê∞∏‰πÖÂà™Èô§„ÄÇ',
                () => {
                    Utils.showLoading('Âà™Èô§‰∏≠...');
                    setTimeout(() => {
                        Utils.hideLoading();
                        Utils.showToast('Â∏≥ËôüÂ∑≤Âà™Èô§', 'success');
                        setTimeout(() => {
                            window.location.href = '../index.html';
                        }, 1000);
                    }, 2000);
                }
            );
        }

        function animateEntrance() {
            gsap.from('.settings-section', {
                duration: 0.5,
                y: 20,
                opacity: 0,
                stagger: 0.1,
                ease: 'power2.out'
            });
        }

        // Close modal when clicking outside
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal(modal.id);
                }
            });
        });
    </script>
</body>
</html>
